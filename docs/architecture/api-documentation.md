# ELYSIUM API Documentation

**Version:** v1.0  
**Last Updated:** September 9, 2025  
**Generated By:** BMad Architecture Agent  

---

## API Overview

The ELYSIUM platform provides a RESTful API built on Next.js API routes, designed to support the luxury jewelry e-commerce experience. The API handles product management, payment processing, and customer inquiries with a focus on security, performance, and reliability.

## Base Configuration

- **Base URL:** `https://your-domain.com/api`
- **Content Type:** `application/json`
- **Authentication:** Currently public endpoints (future: JWT-based auth)
- **Rate Limiting:** To be implemented
- **CORS:** Same-origin policy

---

## API Endpoints

### 1. Products API

#### Get Filtered Products
```http
GET /api/products
```

**Description:** Retrieves a filtered list of products from the Sanity CMS based on query parameters.

**Query Parameters:**
| Parameter | Type | Required | Description |
|-----------|------|----------|-------------|
| `category` | string | No | Product category filter |
| `metal` | string | No | Metal type filter (gold, silver, platinum) |
| `stone` | string | No | Stone type filter |
| `cut` | string | No | Diamond cut filter |
| `priceMin` | number | No | Minimum price filter |
| `priceMax` | number | No | Maximum price filter |
| `limit` | number | No | Number of results to return (default: 50) |
| `offset` | number | No | Pagination offset (default: 0) |

**Example Request:**
```bash
curl -X GET "https://your-domain.com/api/products?category=engagement&metal=gold&priceMin=5000&limit=10"
```

**Response Schema:**
```typescript
interface ProductsResponse {
  products: Product[];
  total: number;
  hasMore: boolean;
}

interface Product {
  _id: string;
  slug: string;
  name: string;
  description: string;
  basePrice: number;
  images: SanityImage[];
  variants: ProductVariant[];
  category: string;
  tags: string[];
  seo: SEOData;
}
```

**Example Response:**
```json
{
  "products": [
    {
      "_id": "product-123",
      "slug": "aveline-radiant-solitaire",
      "name": "Aveline Radiant Solitaire",
      "description": "Radiant solitaire with hidden halo",
      "basePrice": 8500,
      "images": [...],
      "variants": [...],
      "category": "engagement",
      "tags": ["solitaire", "radiant", "hidden-halo"]
    }
  ],
  "total": 42,
  "hasMore": true
}
```

**Error Responses:**
- `400 Bad Request`: Invalid query parameters
- `500 Internal Server Error`: Sanity CMS connection error

---

### 2. Checkout API

#### Create Checkout Session
```http
POST /api/checkout
```

**Description:** Creates a Stripe checkout session for payment processing.

**Request Body Schema:**
```typescript
interface CheckoutRequest {
  items: CheckoutItem[];
}

interface CheckoutItem {
  title: string;
  price: number; // Price in pence (GBP)
  quantity: number;
  productId?: string;
  variant?: string;
}
```

**Example Request:**
```bash
curl -X POST "https://your-domain.com/api/checkout" \
  -H "Content-Type: application/json" \
  -d '{
    "items": [
      {
        "title": "Aveline Radiant Solitaire - 18K Gold",
        "price": 850000,
        "quantity": 1,
        "productId": "product-123",
        "variant": "18k-gold"
      }
    ]
  }'
```

**Response Schema:**
```typescript
interface CheckoutResponse {
  id: string; // Stripe session ID
  url: string; // Redirect URL to Stripe Checkout
}
```

**Example Response:**
```json
{
  "id": "cs_test_1234567890",
  "url": "https://checkout.stripe.com/pay/cs_test_1234567890"
}
```

**Configuration:**
- **Currency:** GBP (British Pounds)
- **Payment Methods:** Card payments via Stripe
- **Success URL:** `/checkout/success`
- **Cancel URL:** `/checkout/cancel`

**Error Responses:**
- `400 Bad Request`: Invalid item data or missing required fields
- `500 Internal Server Error`: Stripe API connection error

---

### 3. Bespoke Inquiry API

#### Submit Bespoke Request
```http
POST /api/bespoke
```

**Description:** Handles custom jewelry consultation requests and sends notification emails.

**Content Type:** `multipart/form-data`

**Form Fields:**
| Field | Type | Required | Description |
|-------|------|----------|-------------|
| `name` | string | Yes | Customer full name |
| `email` | string | Yes | Customer email address |
| `phone` | string | No | Customer phone number |
| `budget` | string | No | Estimated budget range |
| `notes` | string | No | Custom requirements and notes |

**Example Request:**
```bash
curl -X POST "https://your-domain.com/api/bespoke" \
  -F "name=Jane Smith" \
  -F "email=jane@example.com" \
  -F "phone=+44 20 1234 5678" \
  -F "budget=£15,000 - £25,000" \
  -F "notes=Looking for a unique engagement ring with vintage-inspired design"
```

**Response Schema:**
```typescript
interface BespokeResponse {
  ok: boolean;
}
```

**Example Response:**
```json
{
  "ok": true
}
```

**Email Integration:**
- **Service:** Resend API
- **From:** `studio@elysium.example`
- **To:** `hello@elysium.example`
- **Subject:** "New Bespoke Enquiry"

**Future Enhancement:**
- Lead creation in Sanity CMS (currently commented out)
- Customer acknowledgment email
- CRM integration

**Error Responses:**
- `400 Bad Request`: Missing required fields
- `500 Internal Server Error`: Email delivery failure

---

## Data Models

### Product Data Model
```typescript
interface Product {
  _id: string;
  _type: 'product';
  slug: string;
  name: string;
  description: string;
  basePrice: number;
  images: SanityImage[];
  variants: ProductVariant[];
  customization: CustomizationOptions;
  category: string;
  tags: string[];
  seo: SEOSettings;
  createdAt: string;
  updatedAt: string;
}

interface ProductVariant {
  id: string;
  name: string;
  metal: MetalType;
  priceModifier: number;
  availability: boolean;
  images: SanityImage[];
}

interface CustomizationOptions {
  metals: MetalOption[];
  stones: StoneOption[];
  cuts: CutOption[];
  engraving: boolean;
  sizing: SizeRange;
}
```

### Sanity CMS Integration
```typescript
interface SanityImage {
  _type: 'image';
  asset: {
    _ref: string;
    _type: 'reference';
  };
  alt?: string;
  hotspot?: {
    x: number;
    y: number;
    height: number;
    width: number;
  };
}
```

---

## Authentication & Security

### Current Security Measures
- **HTTPS Only:** All API endpoints require SSL/TLS
- **CORS Policy:** Same-origin policy enforced
- **Input Validation:** Basic form validation
- **Environment Variables:** Secure API key management

### Stripe Security
- **PCI Compliance:** Handled by Stripe
- **Webhook Verification:** To be implemented
- **API Key Security:** Server-side only

### Future Security Enhancements
```typescript
// Planned security improvements
interface SecurityEnhancements {
  authentication: 'JWT-based user authentication';
  rateLimiting: 'Redis-based request throttling';
  inputValidation: 'Zod schema validation';
  webhookSecurity: 'Stripe webhook signature verification';
  logging: 'Structured API request logging';
  monitoring: 'Real-time security monitoring';
}
```

---

## Error Handling

### Standard Error Response
```typescript
interface APIError {
  error: {
    code: string;
    message: string;
    details?: any;
  };
  timestamp: string;
  requestId: string;
}
```

### Common Error Codes
| HTTP Status | Code | Description |
|-------------|------|-------------|
| 400 | `INVALID_REQUEST` | Malformed request or missing parameters |
| 401 | `UNAUTHORIZED` | Invalid or missing authentication |
| 403 | `FORBIDDEN` | Insufficient permissions |
| 404 | `NOT_FOUND` | Resource not found |
| 429 | `RATE_LIMITED` | Too many requests |
| 500 | `INTERNAL_ERROR` | Server-side error |
| 502 | `EXTERNAL_SERVICE_ERROR` | Third-party service failure |

---

## Performance & Caching

### Current Performance Features
- **Next.js API Routes:** Optimized server-side processing
- **Sanity CDN:** Fast image and content delivery
- **Stripe Optimization:** Minimal API calls

### Caching Strategy
```typescript
// Future caching implementation
interface CachingLayers {
  redis: 'Session and temporary data cache';
  cdn: 'Static asset caching';
  database: 'Query result caching';
  browser: 'Client-side response caching';
}
```

---

## Integration Details

### Sanity CMS Integration
- **Query Language:** GROQ (Graph-Relational Object Queries)
- **Real-time Updates:** Webhook support for content changes
- **Asset Management:** Optimized image delivery with transformations

### Stripe Integration
- **API Version:** 2024-06-20
- **Supported Features:** Checkout Sessions, Payment Intents
- **Webhook Events:** To be implemented for order confirmation

### Resend Email Integration
- **Transactional Emails:** Bespoke inquiry notifications
- **Email Templates:** Future HTML template support
- **Delivery Tracking:** Open and click tracking available

---

## Development Guidelines

### API Development Standards
1. **TypeScript First:** All endpoints must have proper type definitions
2. **Error Handling:** Consistent error response format
3. **Validation:** Input validation on all POST/PUT endpoints
4. **Documentation:** OpenAPI spec generation (future)
5. **Testing:** Unit tests for all business logic

### Testing Strategy
```typescript
// Planned testing approach
interface APITestStrategy {
  unit: 'Jest for business logic testing';
  integration: 'Supertest for endpoint testing';
  e2e: 'Playwright for full user journey testing';
  performance: 'k6 for load testing';
}
```

---

## Future Roadmap

### Version 2.0 Planned Features
1. **User Authentication:** JWT-based authentication system
2. **Order Management:** Complete order lifecycle management
3. **Inventory Integration:** Real-time inventory checking
4. **Advanced Filtering:** Elasticsearch integration
5. **API Versioning:** Backwards compatibility support

### Version 3.0 Vision
1. **GraphQL API:** Alternative to REST endpoints
2. **Real-time Features:** WebSocket support for live updates
3. **Advanced Analytics:** Customer behavior tracking API
4. **Multi-tenant Support:** B2B portal API endpoints

---

## Support & Maintenance

### Monitoring Requirements
- **API Response Times:** < 200ms average
- **Error Rate:** < 0.1% for all endpoints
- **Uptime Target:** 99.9% availability

### Maintenance Schedule
- **Security Updates:** Monthly dependency updates
- **Performance Review:** Quarterly API optimization
- **Documentation Updates:** Updated with every release

---

*This API documentation is maintained by the development team and reflects the current state of the ELYSIUM platform APIs.*